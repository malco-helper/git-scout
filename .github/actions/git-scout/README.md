# Git Scout GitHub Action

Automated repository analytics and quality gates for your CI/CD pipeline.

## Features

- üîç **Automated Analysis** - Run Git Scout analytics on every PR
- üí¨ **PR Comments** - Post beautiful analytics directly to pull requests
- ‚úÖ **Quality Gates** - Block PRs that don't meet quality standards
- üìä **JSON Output** - Export data for custom integrations
- ‚è∞ **Scheduled Reports** - Generate automated weekly/monthly reports

## Usage

### Basic PR Analytics

```yaml
name: PR Analytics
on: [pull_request]

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - uses: malcohelper/git-scout-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          command: 'stats --since 7d'
          post-comment: true
```

### With Quality Gates

```yaml
- uses: malcohelper/git-scout-action@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    command: 'stats --since 7d'
    post-comment: true
    quality-gate: true
    quality-threshold: 70
    fail-on-quality: true  # Fail PR if quality < threshold
```

### Custom Analysis

```yaml
- uses: malcohelper/git-scout-action@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    command: 'stats --since 30d --author team@company.com'
    post-comment: false  # Don't post comment, just analyze
```

### Scheduled Reports

```yaml
name: Weekly Report
on:
  schedule:
    - cron: '0 9 * * 1'  # Every Monday at 9 AM

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - uses: malcohelper/git-scout-action@v1
        id: scout
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          command: 'stats --since 7d --json'
      
      - name: Post to Slack
        run: |
          # Use ${{ steps.scout.outputs.stats-json }} to send to Slack
```

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `github-token` | GitHub token for API access | Yes | `${{ github.token }}` |
| `command` | Git Scout command to run | No | `stats --since 7d` |
| `post-comment` | Post results as PR comment | No | `true` |
| `quality-gate` | Enable quality gate checks | No | `false` |
| `quality-threshold` | Minimum quality score (0-100) | No | `70` |
| `fail-on-quality` | Fail action if quality gate fails | No | `false` |

## Outputs

| Output | Description |
|--------|-------------|
| `stats-json` | JSON output of the analysis |
| `quality-score` | Overall quality score (0-100) |
| `quality-passed` | Whether quality gate passed (true/false) |

## Examples

### Example 1: PR Comment with Analytics

When a PR is opened, Git Scout will automatically post a comment like:

```markdown
## üîç Git Scout Analysis

**Quality Score**: 85/100 ‚úÖ

### üìä Repository Statistics

| Metric | Value |
|--------|-------|
| Total Commits | 45 |
| Files Changed | 23 |
| Lines Added | +1,234 |
| Lines Removed | -567 |
| Active Authors | 5 |

### üë• Top Contributors

- **Alice**: 20 commits, 15 files
- **Bob**: 15 commits, 10 files
- **Charlie**: 10 commits, 8 files

---

*Generated by Git Scout*
```

### Example 2: Quality Gate Block

If code quality drops below threshold:

```
‚ùå Quality gate failed!
Quality Score: 65/100 < 70 (threshold)

Blocking PR merge until quality improves.
```

## Advanced Workflows

### Multi-Stage Analysis

```yaml
jobs:
  quick-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Quick Analysis
        uses: malcohelper/git-scout-action@v1
        with:
          command: 'today --json'
          quality-gate: true
          fail-on-quality: true
  
  deep-analysis:
    needs: quick-check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Deep Analysis
        uses: malcohelper/git-scout-action@v1
        with:
          command: 'stats --since 30d --json'
          post-comment: true
```

### Export to External System

```yaml
- uses: malcohelper/git-scout-action@v1
  id: analysis
  with:
    command: 'stats --since 7d --json'
    post-comment: false

- name: Send to Datadog
  run: |
    curl -X POST https://api.datadoghq.com/api/v1/series \
      -H "DD-API-KEY: ${{ secrets.DATADOG_API_KEY }}" \
      -d "${{ steps.analysis.outputs.stats-json }}"
```

## Quality Score Calculation

The quality score (0-100) is calculated based on:

- **Code Coverage** (30%) - Test coverage percentage
- **Commit Frequency** (20%) - Regular, consistent commits
- **Code Review** (20%) - PR review participation
- **Code Complexity** (15%) - Low complexity preferred
- **Documentation** (15%) - Adequate documentation

## Troubleshooting

### Action fails with "command not found"

Make sure you're checking out the code with full history:

```yaml
- uses: actions/checkout@v4
  with:
    fetch-depth: 0  # Important: fetch full history
```

### PR comments not posting

Ensure the GitHub token has the correct permissions:

```yaml
permissions:
  pull-requests: write
  contents: read
```

### Quality gate not working

Check that you have:
1. Enabled quality gate: `quality-gate: true`
2. Set a threshold: `quality-threshold: 70`
3. Enabled fail on quality: `fail-on-quality: true`

## Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](../../../CONTRIBUTING.md).

## License

MIT License - see [LICENSE](../../../LICENSE).

## Links

- [Git Scout CLI](https://github.com/malcohelper/git-scout)
- [Documentation](https://github.com/malcohelper/git-scout#readme)
- [Roadmap](https://github.com/malcohelper/git-scout/blob/main/ROADMAP.md)
